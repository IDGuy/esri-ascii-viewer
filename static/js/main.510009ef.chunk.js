(this.webpackJsonpdem=this.webpackJsonpdem||[]).push([[0],{26:function(e,t,r){},27:function(e,t,r){},35:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(12),s=r.n(a),o=(r(26),r(27),r(28),r(13)),c=r.n(o),l=r(14),u=r(8),h=r(9),d=r(16),g=r(15),v=r(6),p=r(37),m=r(38),f=r(1),j=function(e){Object(d.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(u.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).hiddenFileInput=i.a.createRef(),e.handleClick=function(t){var r;null===(r=e.hiddenFileInput.current)||void 0===r||r.click()},e.handleFileChange=function(t){var r=t.target.files;r&&e.props.onFilesChanged(r)},e}return Object(h.a)(r,[{key:"render",value:function(){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(m.a,{onClick:this.handleClick,children:"Select file"}),Object(f.jsx)("input",{type:"file",ref:this.hiddenFileInput,onChange:this.handleFileChange,style:{display:"none"},accept:".asc"})]})}}]),r}(n.Component),w=r(11),x=function(){function e(t){Object(u.a)(this,e),this.file=void 0,this.file=t}return Object(h.a)(e,[{key:"parse",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,r,n,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("asc"!==this.file.name.substring(this.file.name.lastIndexOf(".")+1).toLowerCase()){e.next=17;break}return e.next=4,this.readFile(this.file);case 4:return t=e.sent,e.prev=5,r=this.parseEsriGridProperties(t),n=this.parseEsriGridRasterValues(t,r.noDataValue),i=this.getRasterValueRange(n),e.abrupt("return",new w.b({properties:r,rasterValues:n,minValue:i.min,maxValue:i.max}));case 12:return e.prev=12,e.t0=e.catch(5),e.abrupt("return",new w.a(new Error("Esri ascii grid file is not valid")));case 15:e.next=18;break;case 17:return e.abrupt("return",new w.a(new Error("File must have extension .asc")));case 18:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"parseEsriGridProperties",value:function(e){return{nCols:this.getEsriGridProperty(e,"ncols"),nRows:this.getEsriGridProperty(e,"nrows"),xllCorner:this.getEsriGridProperty(e,"xllcorner"),yllCorner:this.getEsriGridProperty(e,"yllcorner"),cellSize:this.getEsriGridProperty(e,"cellsize"),noDataValue:this.getOptionalEsriGridProperty(e,"nodata_value")}}},{key:"parseEsriGridRasterValues",value:function(e,t){for(var r=new Array,n=6;n<e.length;n++){var i=e[n];if(i){if(!i.trim().length)continue;for(var a=i.trim().split(" "),s=new Array,o=0;o<a.length;o++){var c=0;if(c===t)c=0;else if(c=parseFloat(a[o]),isNaN(c))throw Error('Invalid value "'.concat(a[o],'" found line ').concat(n));s.push(c)}r.push(s)}}return r}},{key:"getEsriGridProperty",value:function(e,t){var r=this.getOptionalEsriGridProperty(e,t);if(void 0===r)throw new Error("Property ".concat(t," does not exist"));return r}},{key:"getOptionalEsriGridProperty",value:function(e,t){for(var r=0;r<6;r++){var n=e[r].split(/ +/);if(n[0]&&n[0].toLowerCase()===t)return n[1]}}},{key:"getRasterValueRange",value:function(e,t){for(var r=null,n=0,i=0;i<e.length;i++)for(var a=e[i],s=0;s<a.length;s++){var o=a[s];(null===r||o<r)&&(r=o),o>n&&(n=o)}return{min:r,max:n}}},{key:"readFile",value:function(e){return new Promise((function(t,r){var n="",i=new FileReader;i.onload=function(e){if(!(n=e.target.result))return new Array;t(n.split(/\r\n|\n/))},i.onerror=function(e){r(e)},i.readAsText(e)}))}}]),e}(),b=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"generate",value:function(e){var t=document.createElement("CANVAS");t.width=e.properties.nCols,t.height=e.properties.nRows;var r=t.getContext("2d");if(r){for(var n=r.getImageData(0,0,t.width,t.height),i=0;i<t.height;i++)for(var a=e.rasterValues[i],s=0;s<t.width;s++){var o=this.calculateBrightness(a[s],e);this.drawPixel(n,t.width,s,i,o,o,o,255)}return r.putImageData(n,0,0),new w.b(t.toDataURL("image/png"))}return new w.a(new Error("Canvas has no context"))}},{key:"calculateBrightness",value:function(e,t){return e!==t.properties.noDataValue&&0!==t.maxValue||(e=0),e/t.maxValue*255}},{key:"drawPixel",value:function(e,t,r,n,i,a,s,o){var c=4*(r+n*t);e.data[c+0]=i,e.data[c+1]=a,e.data[c+2]=s,e.data[c+3]=o}}]),e}(),O=function(){function e(t){Object(u.a)(this,e),this.map=void 0,this.steepness=void 0,this.size=void 0,this.max=void 0,this.size=Math.pow(2,t)+1,this.max=this.size-1,this.map=new Array(this.max)}return Object(h.a)(e,[{key:"generate",value:function(e,t,r,n,i){this.steepness=i,this.set(0,0,this.max),this.set(this.max,0,this.max/2),this.set(this.max,this.max,0),this.set(0,this.max,this.max/2),this.divide(this.max);var a={minValue:0,maxValue:n,properties:{cellSize:1,nCols:t,nRows:r,xllCorner:0,yllCorner:0},rasterValues:this.map};return new w.b(a)}},{key:"get",value:function(e,t){return e<0||e>this.max||t<0||t>this.max?-1:this.map[e][t]}},{key:"set",value:function(e,t,r){this.map[e]||(this.map[e]=new Array(this.max)),this.map[e][t]=r}},{key:"divide",value:function(e){var t,r,n=e/2,i=this.steepness*e;if(!(n<1)){for(r=n;r<this.max;r+=e)for(t=n;t<this.max;t+=e)this.square(t,r,n,Math.random()*i*2-i);for(r=0;r<=this.max;r+=n)for(t=(r+n)%e;t<=this.max;t+=e)this.diamond(t,r,n,Math.random()*i*2-i);this.divide(e/2)}}},{key:"average",value:function(e){var t=e.filter((function(e){return-1!==e}));return t.reduce((function(e,t){return e+t}),0)/t.length}},{key:"square",value:function(e,t,r,n){var i=this.average([this.get(e-r,t-r),this.get(e+r,t-r),this.get(e+r,t+r),this.get(e-r,t+r)]);this.set(e,t,i+n)}},{key:"diamond",value:function(e,t,r,n){var i=this.average([this.get(e,t-r),this.get(e+r,t),this.get(e,t+r),this.get(e-r,t)]);this.set(e,t,i+n)}}]),e}(),k=function(e){Object(d.a)(r,e);var t=Object(g.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).engine=void 0,n.scene=void 0,n.ground=void 0,n.camera=void 0,n.heightMapImage=void 0,n.terrainScaleInterval=void 0,n.terrainScalePercentage=0,n.verticesData=void 0,n.loadFile=function(){var e=Object(l.a)(c.a.mark((function e(t){var r,i,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[0],i=new x(r),e.next=4,i.parse();case 4:a=e.sent,n.clearScaleTerrainInterval(),n.processesriGridDataResult(a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onFilesChanged=function(e){n.loadFile(e)},n.handleClose=function(){n.setState((function(){return{showFileModalOpen:!1}}))},n.triggerOpen=function(){n.setState((function(){return{showFileModalOpen:!0,errorMsg:""}}))},n.triggerPlay=function(){n.setState((function(e){return{isPlaying:!e.isPlaying}}))},n.triggerWireframe=function(){n.setState((function(e){return{isWireframeEnabled:!e.isWireframeEnabled}}),(function(){n.ground&&n.ground.material&&(n.ground.material.wireframe=n.state.isWireframeEnabled)}))},n.triggerScreenshot=function(){v.Tools.CreateScreenshot(n.engine,n.camera,{width:1024,height:1024},(function(e){var t=document.createElement("a");t.href=e,t.download="screenshot-".concat(n.getFormattedTime(),".png");t.addEventListener("click",(function t(){setTimeout((function(){URL.revokeObjectURL(e),document.removeEventListener("click",t)}),150)}),!1),t.click()}))},n.triggerDownload=function(){var e=document.createElement("a");e.href=n.heightMapImage,e.download="heightmap-".concat(n.getFormattedTime(),".png");e.addEventListener("click",(function e(){setTimeout((function(){URL.revokeObjectURL(n.heightMapImage),document.removeEventListener("click",e)}),150)}),!1),e.click()},n.getFormattedTime=function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1).toString().padStart(2,"0")+"-"+e.getDate().toString().padStart(2,"0")+"-"+e.getHours().toString().padStart(2,"0")+"-"+e.getMinutes().toString().padStart(2,"0")+"-"+e.getSeconds().toString().padStart(2,"0")},n.beginScaleTerrain=function(){n.terrainScalePercentage=0,n.terrainScaleInterval=window.setInterval((function(){n.terrainScalePercentage<100?n.terrainScalePercentage+=.5:n.clearScaleTerrainInterval()}),25)},n.clearScaleTerrainInterval=function(){n.terrainScaleInterval&&(window.clearInterval(n.terrainScaleInterval),n.terrainScaleInterval=0)},n.updateMeshPositions=function(e){if(n.terrainScalePercentage<100&&n.verticesData)for(var t=0;t<e.length;t+=3)e[t+1]=n.verticesData[t+1]*(1*n.terrainScalePercentage/100)},n.state={isPlaying:!0,isWireframeEnabled:!1,showFileModalOpen:!1,errorMsg:""},n}return Object(h.a)(r,[{key:"componentDidMount",value:function(){this.init()}},{key:"componentWillUnmount",value:function(){this.clearScaleTerrainInterval()}},{key:"init",value:function(){var e=new O(9),t=Math.pow(2,9)+1,r=e.generate(1,t,t,t,.5);this.processesriGridDataResult(r)}},{key:"processesriGridDataResult",value:function(e){if(e.isOk()){var t=e.value,r=(new b).generate(t);if(r.isOk()){var n=r.value;null!=n&&(this.load(t,n),this.setState((function(){return{showFileModalOpen:!1}})))}else{var i=r.error.message;this.setState((function(){return{errorMsg:i}}))}}else{var a=e.error.message;this.setState((function(){return{errorMsg:a}}))}}},{key:"load",value:function(e,t){var r=this;this.heightMapImage=t;var n=document.getElementById("renderCanvas");this.engine=new v.Engine(n,!0,{preserveDrawingBuffer:!0,stencil:!0}),this.createScene(n,e,t),window.addEventListener("resize",(function(){r.engine.resize()})),this.engine.runRenderLoop((function(){var e=r.scene.activeCamera;r.state.isPlaying&&(e.alpha+=.001),r.scene.render()}))}},{key:"createScene",value:function(e,t,r){var n=this,i=t.properties.nCols>t.properties.nRows?t.properties.nCols:t.properties.nRows;this.scene=new v.Scene(this.engine);var a=new v.PointLight("spot",new v.Vector3(i/2,i,i/2),this.scene);a.diffuse=new v.Color3(1,1,1),a.specular=new v.Color3(0,0,0);var s=1*(t.maxValue-t.minValue)/2;this.camera=new v.ArcRotateCamera("Camera",0,.8,i,new v.Vector3(0,s,0),this.scene),this.camera.lowerBetaLimit=.1,this.camera.upperBetaLimit=Math.PI/2*.9,this.camera.lowerRadiusLimit=30,this.camera.upperRadiusLimit=2*i,this.camera.attachControl(e,!0);var o=new v.StandardMaterial("ground",this.scene);this.ground=v.Mesh.CreateGroundFromHeightMap("ground",r,t.properties.nCols,t.properties.nRows,200,0,t.maxValue,this.scene,!0,(function(){n.verticesData=n.ground.getVerticesData(v.VertexBuffer.PositionKind,!1,!0)})),this.ground.material=o,this.ground.material.wireframe=this.state.isWireframeEnabled,this.beginScaleTerrain();var c=new v.Animation("ra","rotation",15,v.Animation.ANIMATIONTYPE_VECTOR3,v.Animation.ANIMATIONLOOPMODE_CYCLE),l=[];l.push({frame:0,value:this.camera.rotation}),l.push({frame:40,value:new v.Vector3(0,2*-Math.PI,0)}),l.push({frame:80,value:new v.Vector3(0,2*Math.PI,0)}),l.push({frame:120,value:new v.Vector3(0,0,0)}),c.setKeys(l),this.camera.animations.push(c),this.scene.registerBeforeRender((function(){n.ground.updateMeshPositions(n.updateMeshPositions),n.ground.bakeCurrentTransformIntoVertices()}))}},{key:"render",value:function(){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("canvas",{id:"renderCanvas",width:"800",height:"600"}),Object(f.jsxs)("div",{className:"controls",children:[Object(f.jsx)("button",{onClick:this.triggerOpen,children:Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),Object(f.jsx)("span",{children:"Open"})]})}),Object(f.jsx)("button",{onClick:this.triggerPlay,children:this.state.isPlaying?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Object(f.jsx)("span",{children:"Pause"})]}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),Object(f.jsx)("span",{children:"Play"})]})}),Object(f.jsxs)("button",{onClick:this.triggerWireframe,className:"".concat(this.state.isWireframeEnabled?"active":""),children:[Object(f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})}),Object(f.jsx)("span",{children:"Wireframe"})]}),Object(f.jsxs)("button",{onClick:this.triggerScreenshot,children:[Object(f.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),Object(f.jsx)("span",{children:"Screenshot"})]}),Object(f.jsxs)("button",{onClick:this.triggerDownload,children:[Object(f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(f.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),Object(f.jsx)("span",{children:"Download"})]})]}),Object(f.jsxs)(p.a,{show:this.state.showFileModalOpen,onHide:this.handleClose,children:[Object(f.jsx)(p.a.Header,{closeButton:!0}),Object(f.jsxs)(p.a.Body,{children:[Object(f.jsx)("div",{className:"pb-3",children:"Select an Esri Ascii Grid file to view. The file will be processed locally in your browser."}),Object(f.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:Object(f.jsx)(j,{onFilesChanged:this.onFilesChanged})}),this.state.errorMsg&&Object(f.jsx)("div",{className:"d-flex justify-content-center align-items-center text-danger",children:this.state.errorMsg}),Object(f.jsxs)("div",{className:"mt-3",children:["Need a sample file? Download one ",Object(f.jsx)("a",{href:"https://github.com/IDGuy/esri-ascii-viewer/blob/main/sample-resources/castle.asc?raw=true",download:!0,children:"here"})]})]})]})]})}}]),r}(n.Component);var y=function(){return Object(f.jsx)("div",{className:"App",children:Object(f.jsx)(k,{})})},C=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,39)).then((function(t){var r=t.getCLS,n=t.getFID,i=t.getFCP,a=t.getLCP,s=t.getTTFB;r(e),n(e),i(e),a(e),s(e)}))};s.a.render(Object(f.jsx)(i.a.StrictMode,{children:Object(f.jsx)(y,{})}),document.getElementById("root")),C()}},[[35,1,2]]]);
//# sourceMappingURL=main.510009ef.chunk.js.map