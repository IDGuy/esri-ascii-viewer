(this.webpackJsonpdem=this.webpackJsonpdem||[]).push([[0],{26:function(e,t,r){},27:function(e,t,r){},35:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(11),s=r.n(a),o=(r(26),r(27),r(28),r(13)),c=r.n(o),l=r(14),u=r(9),d=r(10),h=r(16),g=r(15),p=r(6),f=r(37),v=r(38),m=r(1),j=function(e){Object(h.a)(r,e);var t=Object(g.a)(r);function r(){var e;Object(u.a)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).hiddenFileInput=i.a.createRef(),e.handleClick=function(t){var r;null===(r=e.hiddenFileInput.current)||void 0===r||r.click()},e.handleFileChange=function(t){var r=t.target.files;r&&e.props.onFilesChanged(r)},e}return Object(d.a)(r,[{key:"render",value:function(){return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(v.a,{onClick:this.handleClick,children:"Select file"}),Object(m.jsx)("input",{type:"file",ref:this.hiddenFileInput,onChange:this.handleFileChange,style:{display:"none"},accept:".asc"})]})}}]),r}(n.Component),w=r(12),b=function(){function e(t){Object(u.a)(this,e),this.file=void 0,this.file=t}return Object(d.a)(e,[{key:"parse",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,r,n,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0,"asc"!==this.file.name.substring(this.file.name.lastIndexOf(".")+1).toLowerCase()){e.next=18;break}return e.next=5,this.readFile(this.file);case 5:return t=e.sent,e.prev=6,r=this.parseEsriGridProperties(t),n=this.parseEsriGridRasterValues(t,r.noDataValue),i=this.getRasterValueRange(n),e.abrupt("return",new w.b({properties:r,rasterValues:n,minValue:i.min,maxValue:i.max}));case 13:return e.prev=13,e.t0=e.catch(6),e.abrupt("return",new w.a(new Error("Esri ascii grid file is not valid")));case 16:e.next=19;break;case 18:return e.abrupt("return",new w.a(new Error("File must have extension .asc")));case 19:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"parseEsriGridProperties",value:function(e){return{nCols:this.getEsriGridProperty(e,"ncols"),nRows:this.getEsriGridProperty(e,"nrows"),xllCorner:this.getEsriGridProperty(e,"xllcorner"),yllCorner:this.getEsriGridProperty(e,"yllcorner"),cellSize:this.getEsriGridProperty(e,"cellsize"),noDataValue:this.getOptionalEsriGridProperty(e,"noDataValue")}}},{key:"parseEsriGridRasterValues",value:function(e,t){for(var r=new Array,n=6;n<e.length;n++){if(e[n]){for(var i=e[n].split(" "),a=new Array,s=0;s<i.length;s++){var o=0;if(o===t)o=0;else if(o=parseFloat(i[s]),isNaN(o))throw Error('Invalid value "'.concat(i[s],'" found line ').concat(n));a.push(o)}r.push(a)}}return r}},{key:"getEsriGridProperty",value:function(e,t){var r=this.getOptionalEsriGridProperty(e,t);if(void 0===r)throw new Error("Property ".concat(t," does not exist"));return r}},{key:"getOptionalEsriGridProperty",value:function(e,t){for(var r=0;r<6;r++){var n=e[r].split(" ");if(n[0]===t)return n[1]}}},{key:"getRasterValueRange",value:function(e,t){for(var r=null,n=0,i=0;i<e.length;i++)for(var a=e[i],s=0;s<a.length;s++){var o=a[s];(null===r||o<r)&&(r=o),o>n&&(n=o)}return{min:r,max:n}}},{key:"readFile",value:function(e){return new Promise((function(t,r){var n="",i=new FileReader;i.onload=function(e){if(!(n=e.target.result))return new Array;t(n.split(/\r\n|\n/))},i.onerror=function(e){r(e)},i.readAsText(e)}))}}]),e}(),x=function(){function e(){Object(u.a)(this,e)}return Object(d.a)(e,[{key:"generate",value:function(e){var t=document.createElement("CANVAS");t.width=e.properties.nCols,t.height=e.properties.nRows;var r=t.getContext("2d");if(r){for(var n=r.getImageData(0,0,t.width,t.height),i=0;i<t.height;i++)for(var a=e.rasterValues[i],s=0;s<t.width;s++){var o=this.calculateBrightness(a[s],e);this.drawPixel(n,t.width,s,i,o,o,o,255)}return r.putImageData(n,0,0),new w.b(t.toDataURL("image/png"))}return new w.a(new Error("Canvas has no context"))}},{key:"calculateBrightness",value:function(e,t){return e!==t.properties.noDataValue&&0!==t.maxValue||(e=0),e/t.maxValue*255}},{key:"drawPixel",value:function(e,t,r,n,i,a,s,o){var c=4*(r+n*t);e.data[c+0]=i,e.data[c+1]=a,e.data[c+2]=s,e.data[c+3]=o}}]),e}(),O=function(e){Object(h.a)(r,e);var t=Object(g.a)(r);function r(e){var n;return Object(u.a)(this,r),(n=t.call(this,e)).engine=void 0,n.scene=void 0,n.ground=void 0,n.camera=void 0,n.heightMapImage=void 0,n.loadFile=function(){var e=Object(l.a)(c.a.mark((function e(t){var r,i,a,s,o,l,u,d,h;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[0],i=new b(r),e.next=4,i.parse();case 4:(a=e.sent).isOk()?(s=a.value,o=new x,(l=o.generate(s)).isOk()?null!=(u=l.value)&&(n.load(s,u),n.setState((function(){return{showFileModalOpen:!1}}))):(d=l.error.message,n.setState((function(){return{errorMsg:d}})))):(h=a.error.message,n.setState((function(){return{errorMsg:h}})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onFilesChanged=function(e){n.loadFile(e)},n.handleClose=function(){n.setState((function(){return{showFileModalOpen:!1}}))},n.triggerOpen=function(){n.setState((function(){return{showFileModalOpen:!0,errorMsg:""}}))},n.triggerPlay=function(){n.setState((function(e){return{isPlaying:!e.isPlaying}}))},n.triggerWireframe=function(){n.setState((function(e){return{isWireframeEnabled:!e.isWireframeEnabled}}),(function(){n.ground&&n.ground.material&&(n.ground.material.wireframe=n.state.isWireframeEnabled)}))},n.triggerScreenshot=function(){p.Tools.CreateScreenshot(n.engine,n.camera,{width:1024,height:1024},(function(e){var t=document.createElement("a");t.href=e,t.download="screenshot-".concat(n.getFormattedTime(),".png");t.addEventListener("click",(function t(){setTimeout((function(){URL.revokeObjectURL(e),document.removeEventListener("click",t)}),150)}),!1),t.click()}))},n.triggerDownload=function(){var e=document.createElement("a");e.href=n.heightMapImage,e.download="heightmap-".concat(n.getFormattedTime(),".png");e.addEventListener("click",(function e(){setTimeout((function(){URL.revokeObjectURL(n.heightMapImage),document.removeEventListener("click",e)}),150)}),!1),e.click()},n.getFormattedTime=function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1).toString().padStart(2,"0")+"-"+e.getDate().toString().padStart(2,"0")+"-"+e.getHours().toString().padStart(2,"0")+"-"+e.getMinutes().toString().padStart(2,"0")+"-"+e.getSeconds().toString().padStart(2,"0")},n.state={isPlaying:!0,isWireframeEnabled:!1,showFileModalOpen:!1,errorMsg:""},n}return Object(d.a)(r,[{key:"load",value:function(e,t){var r=this;this.heightMapImage=t;var n=document.getElementById("renderCanvas");this.engine=new p.Engine(n,!0,{preserveDrawingBuffer:!0,stencil:!0}),this.createScene(n,e,t),window.addEventListener("resize",(function(){console.info("resize"),r.engine.resize()})),this.engine.runRenderLoop((function(){var e=r.scene.activeCamera;r.state.isPlaying&&(e.alpha+=.001),r.scene.render()}))}},{key:"createScene",value:function(e,t,r){var n,i=this,a=0,s=!1,o=t.properties.nCols>t.properties.nRows?t.properties.nCols:t.properties.nRows;setInterval((function(e){a<100&&(a+=.5,console.info(a))}),25),this.scene=new p.Scene(this.engine);var c=new p.PointLight("spot",new p.Vector3(o/2,o,o/2),this.scene);c.diffuse=new p.Color3(1,1,1),c.specular=new p.Color3(0,0,0),this.camera=new p.ArcRotateCamera("Camera",0,.8,o,p.Vector3.Zero(),this.scene),this.camera.lowerBetaLimit=.1,this.camera.upperBetaLimit=Math.PI/2*.9,this.camera.lowerRadiusLimit=30,this.camera.upperRadiusLimit=1.5*o,this.camera.attachControl(e,!0);var l=new p.StandardMaterial("ground",this.scene);this.ground=p.Mesh.CreateGroundFromHeightMap("ground",r,o,o,200,0,t.maxValue,this.scene,!0,(function(){n=i.ground.getVerticesData(p.VertexBuffer.PositionKind,!1,!0)})),this.ground.material=l,this.ground.material.wireframe=this.state.isWireframeEnabled;var u=function(e){if(null!==n)for(var t=0;t<e.length;t+=3)s||(e[t+1]=n[t+1]*(1*a/100),a>=100&&(s=!0))},d=new p.Animation("ra","rotation",15,p.Animation.ANIMATIONTYPE_VECTOR3,p.Animation.ANIMATIONLOOPMODE_CYCLE),h=[];h.push({frame:0,value:this.camera.rotation}),h.push({frame:40,value:new p.Vector3(0,2*-Math.PI,0)}),h.push({frame:80,value:new p.Vector3(0,2*Math.PI,0)}),h.push({frame:120,value:new p.Vector3(0,0,0)}),d.setKeys(h),this.camera.animations.push(d),this.scene.registerBeforeRender((function(){i.ground.updateMeshPositions(u),i.ground.bakeCurrentTransformIntoVertices()}))}},{key:"render",value:function(){return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("canvas",{id:"renderCanvas",width:"800",height:"600"}),Object(m.jsxs)("div",{className:"controls",children:[Object(m.jsx)("button",{onClick:this.triggerOpen,children:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),Object(m.jsx)("span",{children:"Open"})]})}),Object(m.jsx)("button",{onClick:this.triggerPlay,children:this.state.isPlaying?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),Object(m.jsx)("span",{children:"Pause"})]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Object(m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),Object(m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),Object(m.jsx)("span",{children:"Play"})]})}),Object(m.jsxs)("button",{onClick:this.triggerWireframe,className:"".concat(this.state.isWireframeEnabled?"active":""),children:[Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(m.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})}),Object(m.jsx)("span",{children:"Wireframe"})]}),Object(m.jsxs)("button",{onClick:this.triggerScreenshot,children:[Object(m.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Object(m.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),Object(m.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),Object(m.jsx)("span",{children:"Screenshot"})]}),Object(m.jsxs)("button",{onClick:this.triggerDownload,children:[Object(m.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(m.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),Object(m.jsx)("span",{children:"Download"})]})]}),Object(m.jsxs)(f.a,{show:this.state.showFileModalOpen,onHide:this.handleClose,children:[Object(m.jsx)(f.a.Header,{closeButton:!0}),Object(m.jsxs)(f.a.Body,{children:[Object(m.jsx)("div",{className:"pb-3",children:"Select an Esri Ascii Grid file to view. The file will be processed locally in your browser."}),Object(m.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:Object(m.jsx)(j,{onFilesChanged:this.onFilesChanged})}),this.state.errorMsg&&Object(m.jsx)("div",{className:"d-flex justify-content-center align-items-center text-danger",children:this.state.errorMsg}),Object(m.jsxs)("div",{className:"mt-3",children:["Need a sample file? Download one ",Object(m.jsx)("a",{href:"https://github.com/IDGuy/esri-ascii-viewer/blob/main/sample-resources/castle.asc?raw=true",download:!0,children:"here"})]})]})]})]})}}]),r}(n.Component);var k=function(){return Object(m.jsx)("div",{className:"App",children:Object(m.jsx)(O,{})})},y=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,39)).then((function(t){var r=t.getCLS,n=t.getFID,i=t.getFCP,a=t.getLCP,s=t.getTTFB;r(e),n(e),i(e),a(e),s(e)}))};s.a.render(Object(m.jsx)(i.a.StrictMode,{children:Object(m.jsx)(k,{})}),document.getElementById("root")),y()}},[[35,1,2]]]);
//# sourceMappingURL=main.a49aaaa3.chunk.js.map